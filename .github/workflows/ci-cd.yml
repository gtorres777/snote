name: Sync Prod Notebooks
on: 
  push: 
    branches: [ master ]
    
env:
  DATABRICKS_WORKSPACE: ${{ secrets.DATABRICKS_WORKSPACE }}
  DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}

jobs:
  Sync-Notebooks:
    runs-on: self-hosted
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Submit Update Request to Databricks API
        run: sh ./.github/scripts/notebooksync.sh
      # - name: Slack Alert
      #   if: ${{ failure() }}
      #   env:
      #     REPO: ${{  github.repository  }}
      #     WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
      #     AUTHOR: ${{ github.actor  }}
      #     FAILED_JOB: ${{ github.job }}
      #     DOCKER_REGISTRY: "eds.docker.artifactory.global.bamgrid.net"
      #   run: |
      #       export WORKFLOW_URL="$GITHUB_SERVER_URL/$GITHUB_REPOSITORY/actions/runs/$GITHUB_RUN_ID"
      #       export BRANCH="${GITHUB_REF#refs/heads/}"
      #       docker run -e BRANCH -e REPO -e WEBHOOK_URL -e AUTHOR -e FAILED_JOB -e WORKFLOW_URL "$DOCKER_REGISTRY"/slackalert_workflow_failure/slack-alert:latest
